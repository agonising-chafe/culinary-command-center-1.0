# Culinary Command Center 1.0

This project is a Next.js application designed as a culinary command center for planning recipes and managing culinary tasks.

## Project Structure

- `app/` — App Router pages and layout
- `components/` — Reusable UI components
- `data/` — JSON data files (e.g., recipes)
- `lib/` — Store and utilities
- `next.config.js` — Next.js configuration
- `package.json` — Scripts and dependencies

## Getting Started

1) Install dependencies

```bash
npm install
```

2) Run the dev server

```bash
npm run dev
```

3) Open http://localhost:3000

4) Quick checks
- Health: http://localhost:3000/api/health
- Recipes: http://localhost:3000/api/recipes

## Features

- Dashboard with recipe planning
- Recipe cards and modal view
- Export/Print actions
- PWA with manifest and update UX

## Supabase Persistence

Enable live data via Supabase. The app falls back to bundled mock data if env vars are missing or the API fails.

1) Library (already listed; install ensures it’s present)

```bash
npm install @supabase/supabase-js
```

2) Create `.env.local`

```
NEXT_PUBLIC_SUPABASE_URL=https://<project>.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=<anon-key>
NEXT_PUBLIC_SUPABASE_SCHEMA=public        # optional
NEXT_PUBLIC_SUPABASE_IMAGE_COLUMN=image_url  # or "image"
```

3) Table schema and defaults (Postgres)

```sql
create table if not exists public.recipes (
  id uuid primary key default gen_random_uuid(),
  name text not null,
  image_url text,
  time int default 0,
  calories int default 0,
  ingredients jsonb default '[]'::jsonb,
  instructions jsonb default '[]'::jsonb,
  created_at timestamptz default now()
);

alter table public.recipes
  alter column time drop not null,
  alter column time set default 0,
  alter column calories drop not null,
  alter column calories set default 0;

alter table public.recipes
  alter column ingredients drop default,
  alter column instructions drop default;

alter table public.recipes
  alter column ingredients type jsonb using to_jsonb(ingredients),
  alter column instructions type jsonb using to_jsonb(instructions);

alter table public.recipes
  alter column ingredients set default '[]'::jsonb,
  alter column instructions set default '[]'::jsonb;
```

4) Test locally

```bash
npm run dev
```

- GET: http://localhost:3000/api/recipes
- Health: http://localhost:3000/api/health
- POST/PUT/DELETE: see docs/BLUEPRINT.md for contract

## Deployment

- Architecture and data flow: see `docs/BLUEPRINT.md`

Vercel settings (recommended)
- Framework: Next.js
- Node.js: 20
- Install: npm ci (or npm install)
- Build: next build
- Output Directory: default (Next-managed)

Env (Vercel → Project Settings → Environment)
- NEXT_PUBLIC_SUPABASE_URL
- NEXT_PUBLIC_SUPABASE_ANON_KEY
- NEXT_PUBLIC_SUPABASE_SCHEMA (optional)
- NEXT_PUBLIC_SUPABASE_IMAGE_COLUMN (optional)

PWA notes
- PWA enabled only in production (`next build && next start`)
- Service worker generated by `next-pwa`; do not commit `public/sw.js`
- Dev safeguards: auto-unregister SW and clear caches to prevent stale chunks
- Manifest path: `/manifest.webmanifest` (also at `public/manifest.webmanifest`)

Troubleshooting
- If deploy fails during “Deploying outputs…”, retry (often transient). If it persists, contact Vercel Support with the deployment ID.
- If clients fetch missing chunks after deploy, use the in-app Refresh button or hard refresh to activate the new service worker.

## License

MIT